  name: Test Build
  
  on:
    pull_request:
    push:
      branches:
        - develop
        - release/*

  env:
    SOLUTION_NAME: AVnetCore
    PROJECT_NAME: UXAV.AVnet.Core
    CONFIG: Release

  jobs:
    build:
      runs-on: windows-latest
      steps:
        - uses: actions/checkout@v4
          with:
            fetch-depth: 0
            lfs: true

        - name: Get version
          shell: powershell
          run: |
            $version = ./.github/scripts/GetVersionFromAssemblyInfo.ps1 -Path ${{env.PROJECT_NAME}}/Properties/AssemblyInfo.cs
            Write-Output "Version is: $version"
            echo "VERSION=$version" | Out-File -FilePath $env:GITHUB_ENV -Encoding utf8 -Append

        - name: Setup MsBuild
          uses: microsoft/setup-msbuild@v2
          
        - name: Setup NuGet.exe
          uses: NuGet/setup-nuget@v2
          
        - name: Nuget Add Source
          run: nuget sources Add -Name "uxav" -Source https://nuget.pkg.github.com/uxav/index.json -username uxav -password ${{ secrets.GITHUB_TOKEN }} -StorePasswordInClearText

        - name: Restore Nuget Packages
          run: nuget restore ${{env.SOLUTION_NAME}}.sln

        - name: Build
          run: msbuild ${{env.SOLUTION_NAME}}.sln /p:Configuration=${{env.CONFIG}}
          
        - name: Pack Nuget
          run: nuget pack ${{env.PROJECT_NAME}}/${{env.PROJECT_NAME}}.csproj -Properties Configuration=${{env.CONFIG}}